function initializePaperAdd() {
    $('#modal').find('.modal-dialog').addClass('modal-lg');

    var table = $('#paperDataTable').DataTable({
        bFilter: false,
        bInfo: false,
        bPaginate: false,
        bRetrieve: true,
        bSort: false,
        sDom: "<'row'<'col-xs-6'l><'col-xs-6'f>r>t<'row'<'col-xs-6'i><'col-xs-6'p>>",
        sPaginationType: "bootstrap",
        order: [[1, 'asc']],
        columnDefs: [
            {orderable: false, targets: 0}
        ],
        oLanguage: {
            "sEmptyTable": "No Authors have been defined.",
            "sZeroRecords": "No Authors have been defined."
        }
    });

    $('.dataTables_empty').parent().addClass('datatable_empty_hover');

    table.MakeCellsEditable({
        onUpdate: myCallbackFunction,
        inputCss: 'form-control',
        columns: [1, 2, 3]
    });

    $('#addRow').on('click', function () {
        table.row.add([
            "<i class='fa fa-trash-o delete_icon pointer-cursor'></i>",
            '*** Author Name ***',
            '*** Affiliation ***',
            '*** Email Address ***'
        ]).draw();

        $('.delete_icon').unbind();
        $('.delete_icon').click(function () {
            table.row($(this).closest('tr')).remove().draw();
        });
    });

    $('#deleteRow').click(function () {
        table.row('.selected').remove().draw(false);
    });


    $('#abstract').autosize({placeholder: false});

    function myCallbackFunction(updatedCell, updatedRow, oldValue) {
        if (updatedCell.data().length == 0) {
            updatedCell.data($.trim(oldValue)).draw();
        }
    }

}

function initializePaperFileUploader(conferenceid) {
    var table = $('#paperDataTable').DataTable();

    $('#uploadButton').text("Upload");
    $('#progress').hide();
    $('#fileName').text("");
    $(document).bind('drop dragover', function (e) {
        e.preventDefault();
    });

    $('#closeButton').click(function () {
        $('#uploadButton').text("Upload");
        $('#progress').hide();
        $('#fileName').text("");
    });

    $('#new_paper').validate({
        rules: {
            'paper[title]': {
                required: true
            }
        }
    });

    $('input[name="fileData"]').fileupload({
        singleFileUploads: true,
        multipart: false,
        url: '/papers?conference_id=' + conferenceid,
        sequentialUploads: true,
        dataType: 'json',
        dropZone: $('#drag-area'),
        method: 'POST',
        progressall: function (e, data) {
            var progress = parseInt(data.loaded / data.total * 100, 10);
            $('#progress .bar').css(
                'width',
                progress + '%'
            );
        },
        always: function (e, data) {
            var result = JSON.parse(JSON.stringify(data._response.result));
            $('#closeButton').click();
            $('#uploadButton').removeClass('disabled');
            $('.select-button').removeClass('disabled');

            if (result.status == 'internal_server_error') {
                showErrorMsg(result.message);
            } else {
                showNotificationMsg(result.message);
                $.pjax.reload('[data-pjax-container]');
            }

        },
        add: function (e, data) {
            $('#fileName').text("[" + data.files[0].name + "]");
            $('#uploadButton').removeClass('disabled');
            var uploadurl = $('input[name="fileData"]').fileupload('option', 'url');
            $('#uploadButton').unbind();
            data.context = $('#uploadButton').click(function () {
                if ($('#new_paper').valid()) {
                    $('#uploadButton').text("Uploading");
                    $('#progress').fadeIn('slow');
                    $('#uploadButton').addClass('disabled');
                    $('.select-button').addClass('disabled');
                    $('#closeButton').hide();
                    $('input[name="fileData"]').fileupload('option', 'url', uploadurl + "&filename=" + data.files[0].name +
                        "&filesize=" + data.files[0].size +
                        "&type=" + data.files[0].type +
                        "&paper[title]=" + $('#paper_title').val() +
                        "&paper[author]=" + table.columns(1).data().eq(0).join(';') +
                        "&paper[abstract]=" + $('#paper_abstract').val() +
                        "&paper[year]=" + $('#paper_year').val() +
                        "&paper[email]=" + table.columns(3).data().eq(0).join(';') +
                        "&paper[affiliation]=" + table.columns(2).data().eq(0).join(';'));
                    var jqXHR = data.submit();
                } else {
                    return false;
                }

            });
        }
    });
}

function initializePapersView() {

    function format(td) {
        var child = '<table id="subDataTable" class="table paircon-table table-responsive dataTable">' +
            '<thead>' +
            '<tr role="row">' +
            '<th>Author Name</th>' +
            '<th>Affiliation</th>' +
            '<th>Email Address</th>' +
            '</tr>' +
            '</thead>' +
            '<tbody>';

        var author_information = JSON.parse(JSON.stringify(td.data('authorinfo')));

        for (var i = 0; i < author_information.length; i++) {
            child = child + '<tr role="row">' +
                '<td>' + author_information[i].author + '</td>' +
                '<td>' + author_information[i].affiliation + '</td>' +
                '<td>' + author_information[i].email + '</td>' +
                '</tr>';
        }

        child = child +
            '</tbody>' +
            '</table>';

        return child;
    }

    var table = $('#datatable-papers').DataTable({
        responsive: true,
        bFilter: false,
        bInfo: false,
        bPaginate: false,
        sDom: "<'row'<'col-xs-6'l><'col-xs-6'f>r>t<'row'<'col-xs-6'i><'col-xs-6'p>>",
        sPaginationType: "bootstrap",
        oLanguage: {
            "sEmptyTable": "",
            "sZeroRecords": ""
        },
        order: [[1, 'asc']],
        columnDefs: [
            {targets: 2, render: $.fn.dataTable.render.ellipsis(250, true)},
            {targets: 'no-sort', orderable: false}
        ]
    });

    // Add event listener for opening and closing details
    $('#datatable-papers').on('click', 'td.details-control', function () {
        var tr = $(this).closest('tr');
        var row = table.row(tr);

        if (row.child.isShown()) {
            // This row is already open - close it
            row.child.hide();
            row.child.remove().draw();
            tr.removeClass('shown');
        } else {
            // Open this row
            row.child(format(tr)).show();

            $('#subDataTable').DataTable({
                bFilter: false,
                bInfo: false,
                bPaginate: false,
                bRetrieve: true,
                bSort: false,
                sDom: "<'row'<'col-xs-6'l><'col-xs-6'f>r>t<'row'<'col-xs-6'i><'col-xs-6'p>>",
                sPaginationType: "bootstrap",
                order: [[1, 'asc']],
                columnDefs: [
                    {orderable: false, targets: 0}
                ],
                oLanguage: {
                    "sEmptyTable": "No Authors have been defined.",
                    "sZeroRecords": "No Authors have been defined."
                }
            });

            $('#subDataTable_wrapper').closest('tr').addClass('datatable_empty_hover');

            $('.dataTables_empty').parent().addClass('datatable_empty_hover');

            tr.addClass('shown');
        }
    });

    removeEmptyRowsDataTable();
}